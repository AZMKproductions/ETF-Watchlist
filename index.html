<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>ETF Watchlist | Real-Time Market Data</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--primary-bg:#0f1419;--secondary-bg:#1a1f2e;--card-bg:#242b3d;--accent-color:#00d4ff;--success-color:#00c896;--danger-color:#ff4757;--warning-color:#ffa502;--text-primary:#ffffff;--text-secondary:#8892b0;--border-color:#2d3748;--shadow:0 10px 25px rgba(0,0,0,.3)}
body{font-family:Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Arial,sans-serif;background:linear-gradient(135deg,var(--primary-bg) 0%,#1a1f2e 100%);color:var(--text-primary);min-height:100vh;line-height:1.6}
.container{max-width:1600px;margin:0 auto;padding:20px}
.header{background:var(--card-bg);border-radius:16px;padding:30px 40px;margin-bottom:30px;border:1px solid var(--border-color);box-shadow:var(--shadow)}
.header-content{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:20px}
.header-left h1{font-size:2.2rem;font-weight:700;margin-bottom:8px;background:linear-gradient(135deg,var(--accent-color),#64ffda);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.subtitle{color:var(--text-secondary);font-size:1.05rem}
.last-updated{color:var(--text-secondary);font-size:.9rem}
.refresh-btn{background:linear-gradient(135deg,var(--accent-color),#0ea5e9);color:#fff;border:none;padding:12px 24px;border-radius:12px;cursor:pointer;font-weight:600;font-size:.95rem;transition:.3s;box-shadow:0 4px 15px rgba(0,212,255,.3)}
.refresh-btn:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(0,212,255,.4)}
.refresh-btn:disabled{opacity:.6;cursor:not-allowed;transform:none}
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-bottom:30px}
.stat-card{background:var(--card-bg);border:1px solid var(--border-color);border-radius:12px;padding:20px;text-align:center}
.stat-value{font-size:1.6rem;font-weight:700;margin-bottom:5px}
.stat-label{color:var(--text-secondary);font-size:.9rem}
.loading{display:flex;justify-content:center;align-items:center;padding:28px;font-size:1.05rem;color:var(--text-secondary)}
.loader{border:3px solid var(--border-color);border-top:3px solid var(--accent-color);border-radius:50%;width:26px;height:26px;animation:spin 1s linear infinite;margin-right:12px}
@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
.table-container{background:var(--card-bg);border-radius:16px;border:1px solid var(--border-color);box-shadow:var(--shadow);overflow:hidden}
.table-header{padding:16px 22px;border-bottom:1px solid var(--border-color);display:flex;justify-content:space-between;align-items:center}
.table-title{font-size:1.1rem;font-weight:600}
.data-status{display:flex;align-items:center;gap:8px;font-size:.85rem;padding:6px 12px;border-radius:8px}
.status-real{background:rgba(39,174,96,.2);color:#2ecc71}
.status-error{background:rgba(255,71,87,.2);color:#ff4757}
.status-demo{background:rgba(255,165,2,.2);color:#ffa502}
.etf-table{width:100%;border-collapse:collapse}
.etf-table thead{background:var(--secondary-bg)}
.etf-table th{padding:14px 12px;text-align:left;font-weight:600;font-size:.8rem;text-transform:uppercase;letter-spacing:.8px;color:var(--text-secondary);border-bottom:2px solid var(--border-color);cursor:pointer;user-select:none;transition:background .2s}
.etf-table th:hover{background:rgba(0,212,255,.1)}
.etf-table tbody tr{transition:.2s;border-bottom:1px solid var(--border-color)}
.etf-table tbody tr:hover{background:rgba(0,212,255,.05)}
.etf-table td{padding:12px;vertical-align:middle;font-size:.92rem;border-bottom:1px solid rgba(45,55,72,.5)}
.ticker{font-weight:700;font-size:1rem;color:var(--accent-color)}
.price{font-weight:600;font-size:1rem;color:var(--text-primary);font-family:JetBrains Mono,monospace}
.daily-return{font-weight:700;padding:6px 10px;border-radius:8px;text-align:center;min-width:84px;font-family:JetBrains Mono,monospace;font-size:.9rem}
.positive{background:linear-gradient(135deg,var(--success-color),#2dd4bf);color:#fff}
.negative{background:linear-gradient(135deg,var(--danger-color),#ef4444);color:#fff}
.neutral{background:linear-gradient(135deg,#6b7280,#9ca3af);color:#fff}
.badge{padding:4px 8px;border-radius:6px;font-size:.8rem;font-weight:600;display:inline-block}
.badge-yield{background:rgba(100,255,218,.2);color:#64ffda}
.badge-exp{background:rgba(255,165,2,.2);color:#ffa502}
.data-source{font-size:.7rem;color:var(--text-secondary);margin-top:4px}
@media (max-width:860px){.container{padding:14px}.header-content{flex-direction:column;text-align:center}.header-left h1{font-size:1.8rem}}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="header-content">
      <div class="header-left">
        <h1>üìä ETF Watchlist</h1>
        <div class="subtitle">Live prices & daily returns ‚Äî auto-refreshes every 60s</div>
      </div>
      <div class="header-right">
        <div class="last-updated" id="lastUpdated">Ready‚Ä¶</div>
        <button class="refresh-btn" id="refreshBtn">üîÑ Refresh</button>
      </div>
    </div>
  </div>

  <div class="stats-grid" id="statsGrid" style="display:none;">
    <div class="stat-card"><div class="stat-value" id="totalETFs">-</div><div class="stat-label">Total ETFs</div></div>
    <div class="stat-card"><div class="stat-value" id="gainers">-</div><div class="stat-label">Gainers</div></div>
    <div class="stat-card"><div class="stat-value" id="losers">-</div><div class="stat-label">Losers</div></div>
    <div class="stat-card"><div class="stat-value" id="avgReturn">-</div><div class="stat-label">Avg Return</div></div>
  </div>

  <div id="loading" class="loading" style="display:none;">
    <div class="loader"></div>Loading market data‚Ä¶
  </div>

  <div class="table-container" id="tableContainer" style="display:none;">
    <div class="table-header">
      <div class="table-title">Market Data</div>
      <div class="data-status status-real" id="dataStatus"><span>‚úÖ</span><span>Live (Yahoo via proxy)</span></div>
    </div>
    <div style="overflow-x:auto;">
      <table class="etf-table">
        <thead>
          <tr>
            <th data-col="ticker">Ticker</th>
            <th data-col="price">Price</th>
            <th data-col="dailyReturn">Daily Return</th>
            <th>Yield</th>
            <th>Expense</th>
            <th>Assets</th>
            <th>Frequency</th>
            <th>Strategy</th>
            <th>Risk</th>
          </tr>
        </thead>
        <tbody id="etfTableBody"></tbody>
      </table>
    </div>
  </div>
</div>

<script>
// ====== CONFIG: edit your tickers here ======
const TICKERS = [
  "TLT","IEF","AGG","BND","CGCP","SHY","TLTW","AGGH",
  "SCHD","DVY","DGRO","VTV","FDL","DIVO","FDVV","SPYV","DIVB","DGRW","CGDV","VIG",
  "CGCV","HELO","SPY","VOO","QQQ","QQQM","SCHG","GARP","SPMO","SMH","VFLO","JQUA","CGGR",
  "JEPI","JEPQ","GPIQ","QQQI","GPIX","SPYI","QDVO","RSPA","IWMI","BALI",
  "VYMI","IDVO","IWM","AVUV","XMMO","XSMO"
];

// Static metadata for side columns (optional; cosmetic)
const META = {
  TLT:{yield:"3-5%",expense:"0.15%",assets:"$49 B",frequency:"Monthly",strategy:"Fixed Income (Long-term)",risk:"High"},
  IEF:{yield:"3-4%",expense:"0.15%",assets:"$34 B",frequency:"Monthly",strategy:"Fixed Income (Medium-term)",risk:"Medium/High"},
  AGG:{yield:"3-4%",expense:"0.03%",assets:"$123 B",frequency:"Monthly",strategy:"Fixed Income (Mix)",risk:"Medium"},
  BND:{yield:"3-4%",expense:"0.03%",assets:"$353 B",frequency:"Monthly",strategy:"Fixed Income (Mix)",risk:"Medium"},
  CGCP:{yield:"4-5%",expense:"0.34%",assets:"$5 B",frequency:"Monthly",strategy:"Fixed Income (Mix)",risk:"Medium"},
  SHY:{yield:"3-4%",expense:"0.15%",assets:"$24 B",frequency:"Monthly",strategy:"Fixed Income (Short/Medium-term)",risk:"Low"},
  TLTW:{yield:"15-20%",expense:"0.35%",assets:"$1 B",frequency:"Monthly",strategy:"FI + High Income (Long-term)",risk:"Med/High + Income"},
  AGGH:{yield:"8-10%",expense:"0.29%",assets:"$300 M",frequency:"Monthly",strategy:"FI + High Income (Mix)",risk:"Med + Income"},
  SCHD:{yield:"3-4%",expense:"0.06%",assets:"$69 B",frequency:"Quarterly",strategy:"Dividend Growth (Value)",risk:"Med/High"},
  DVY:{yield:"3-4%",expense:"0.38%",assets:"$20 B",frequency:"Quarterly",strategy:"Dividend Growth (Value)",risk:"Med/High"},
  DGRO:{yield:"2-3%",expense:"0.08%",assets:"$31 B",frequency:"Quarterly",strategy:"Dividend Growth (Blend)",risk:"High"},
  VTV:{yield:"2-3%",expense:"0.04%",assets:"$181 B",frequency:"Quarterly",strategy:"Dividend Growth (Value)",risk:"Med/High"},
  FDL:{yield:"4%",expense:"0.45%",assets:"$31 B",frequency:"Quarterly",strategy:"Dividend Growth (Value)",risk:"Med/High"},
  DIVO:{yield:"4-6%",expense:"0.56%",assets:"$4.4 B",frequency:"Monthly",strategy:"Dividend Growth (Value)",risk:"Med/High"},
  FDVV:{yield:"2-4%",expense:"0.16%",assets:"$5.2 B",frequency:"Quarterly",strategy:"Dividend Growth (Growth)",risk:"High"},
  SPYV:{yield:"2%",expense:"0.04%",assets:"$26.2B",frequency:"Quarterly",strategy:"Dividend Growth (Growth)",risk:"High"},
  DIVB:{yield:"2-3%",expense:"0.05%",assets:"~$1 B",frequency:"Quarterly",strategy:"Dividend Growth (Growth)",risk:"High"},
  DGRW:{yield:"1.5-2%",expense:"0.29%",assets:"$15 B",frequency:"Monthly",strategy:"Dividend Growth (Growth)",risk:"High"},
  CGDV:{yield:"1.5-2%",expense:"0.33%",assets:"$16.4 B",frequency:"Quarterly",strategy:"Dividend Growth (Growth)",risk:"High"},
  VIG:{yield:"1-2%",expense:"0.05%",assets:"$105 B",frequency:"Quarterly",strategy:"Dividend Growth (Growth)",risk:"High"},
  CGCV:{yield:"1-2%",expense:"0.33%",assets:"$900 M",frequency:"Quarterly",strategy:"Conservative Growth",risk:"Medium"},
  HELO:{yield:"<1%",expense:"0.50%",assets:"$3 B",frequency:"Quarterly",strategy:"Conservative Growth",risk:"Med/High"},
  SPY:{yield:"<1.5%",expense:"0.09%",assets:"$600 B",frequency:"Quarterly",strategy:"Growth",risk:"High"},
  VOO:{yield:"<1.5%",expense:"0.03%",assets:"$1.33 T",frequency:"Quarterly",strategy:"Growth",risk:"High"},
  QQQ:{yield:"<1%",expense:"0.20%",assets:"$330 B",frequency:"Quarterly",strategy:"Growth",risk:"Very High"},
  QQQM:{yield:"<1%",expense:"0.15%",assets:"$49 B",frequency:"Quarterly",strategy:"Growth",risk:"Very High"},
  SCHG:{yield:"<1%",expense:"0.04%",assets:"$41 B",frequency:"Quarterly",strategy:"Growth",risk:"Very High"},
  GARP:{yield:"<1%",expense:"0.15%",assets:"$430 M",frequency:"Quarterly",strategy:"Growth",risk:"Very High"},
  SPMO:{yield:"<1%",expense:"0.13%",assets:"$7.5 B",frequency:"Quarterly",strategy:"Growth",risk:"Very High"},
  SMH:{yield:"<1%",expense:"0.35%",assets:"$22 B",frequency:"Annual",strategy:"Growth",risk:"Very High"},
  VFLO:{yield:"1-2%",expense:"0.39%",assets:"$4 B",frequency:"Monthly",strategy:"Growth",risk:"Very High"},
  JQUA:{yield:"1-2%",expense:"0.12%",assets:"$6.2 B",frequency:"Quarterly",strategy:"Growth",risk:"High"},
  CGGR:{yield:"<1%",expense:"0.39%",assets:"$12.1 B",frequency:"Quarterly",strategy:"Growth",risk:"Very High"},
  JEPI:{yield:"7-10%",expense:"0.35%",assets:"$40 B",frequency:"Monthly",strategy:"Value + High Income",risk:"Med + Income"},
  JEPQ:{yield:"9-12%",expense:"0.35%",assets:"$25 B",frequency:"Monthly",strategy:"Growth + High Income",risk:"High + Income"},
  GPIQ:{yield:"8-11%",expense:"0.29%",assets:"$800 M",frequency:"Monthly",strategy:"Growth + High Income",risk:"High + Income"},
  QQQI:{yield:"12-15%",expense:"0.68%",assets:"$1.6 B",frequency:"Monthly",strategy:"Growth + High Income",risk:"High + Income"},
  GPIX:{yield:"7-10%",expense:"0.29%",assets:"$800 M",frequency:"Monthly",strategy:"Growth + High Income",risk:"Med/High + Income"},
  SPYI:{yield:"11-13%",expense:"0.68%",assets:"$3.5 B",frequency:"Monthly",strategy:"Growth + High Income",risk:"Med/High + Income"},
  QDVO:{yield:"9-12%",expense:"0.55%",assets:"$50 M",frequency:"Monthly",strategy:"Growth + High Income",risk:"High + Income"},
  RSPA:{yield:"9-10%",expense:"0.29%",assets:"$430 M",frequency:"Monthly",strategy:"Balanced Growth + High Income",risk:"High + Income"},
  IWMI:{yield:"14-15%",expense:"0.68%",assets:"$250 M",frequency:"Monthly",strategy:"Growth + High Income",risk:"Very High + Income"},
  BALI:{yield:"8-10%",expense:"0.35%",assets:"$330 M",frequency:"Monthly",strategy:"Growth + High Income",risk:"High + Income"},
  VYMI:{yield:"3-4%",expense:"0.17%",assets:"$10.2 B",frequency:"Quarterly",strategy:"International Dividend Growth",risk:"Med/High"},
  IDVO:{yield:"4-6%",expense:"0.66%",assets:"$260 M",frequency:"Monthly",strategy:"Intl Div Growth/High Income",risk:"Med/High + Income"},
  IWM:{yield:"<1%",expense:"0.19%",assets:"$63 B",frequency:"Quarterly",strategy:"Small Cap Growth",risk:"Very High"},
  AVUV:{yield:"1-2%",expense:"0.25%",assets:"$15.6 B",frequency:"Quarterly",strategy:"Small Cap Growth",risk:"Very High"},
  XMMO:{yield:"<1%",expense:"0.34%",assets:"$3.8 B",frequency:"Quarterly",strategy:"Mid Cap Growth",risk:"Very High"},
  XSMO:{yield:"<1%",expense:"0.39%",assets:"$1.5 B",frequency:"Quarterly",strategy:"Small Cap Growth",risk:"Very High"}
};

let etfData = [];
let sortDir = -1; // toggle sort direction

function classForReturn(pct){
  if (!isFinite(pct)) return "neutral";
  if (pct > 0) return "positive";
  if (pct < 0) return "negative";
  return "neutral";
}

// ---- Fetch quotes via Yahoo Finance using a public CORS relay (no API key) ----
// Endpoint: https://query1.finance.yahoo.com/v7/finance/quote?symbols=SPY,QQQ
// Relay: https://api.allorigins.win/raw?url=<encoded_target_url>
async function fetchQuotesYahoo(symbols){
  const yahooURL = "https://query1.finance.yahoo.com/v7/finance/quote?symbols=" + encodeURIComponent(symbols.join(","));
  const proxied = "https://api.allorigins.win/raw?url=" + encodeURIComponent(yahooURL);
  const res = await fetch(proxied, { cache: "no-store" });
  if (!res.ok) throw new Error("Quote fetch failed: " + res.status);
  const json = await res.json();
  const items = json && json.quoteResponse && Array.isArray(json.quoteResponse.result)
    ? json.quoteResponse.result : [];
  return items.map(it => ({
    symbol: it.symbol,
    price: (typeof it.regularMarketPrice === "number") ? it.regularMarketPrice : null,
    change: (typeof it.regularMarketChange === "number") ? it.regularMarketChange : null,
    changePercent: (typeof it.regularMarketChangePercent === "number") ? it.regularMarketChangePercent : null,
    prevClose: (typeof it.regularMarketPreviousClose === "number") ? it.regularMarketPreviousClose : null,
    time: it.regularMarketTime ? new Date(it.regularMarketTime * 1000).toISOString() : null,
    source: "Yahoo"
  }));
}

async function load(){
  const loading = document.getElementById('loading');
  const table = document.getElementById('tableContainer');
  const stats = document.getElementById('statsGrid');
  const btn = document.getElementById('refreshBtn');
  const last = document.getElementById('lastUpdated');
  const status = document.getElementById('dataStatus');

  btn.disabled = true;
  loading.style.display = 'flex';
  table.style.display = 'none';
  stats.style.display = 'none';
  status.className = 'data-status status-real';
  status.innerHTML = '<span>‚úÖ</span><span>Live (Yahoo via proxy)</span>';

  try{
    // Yahoo supports up to ~50 symbols per call; chunk if needed
    const CHUNK = 45;
    let rows = [];
    for (let i = 0; i < TICKERS.length; i += CHUNK) {
      const slice = TICKERS.slice(i, i + CHUNK);
      const part = await fetchQuotesYahoo(slice);
      rows = rows.concat(part);
      // small delay to be nice
      await new Promise(r => setTimeout(r, 250));
    }

    // Merge with META
    etfData = rows.map(r => {
      const meta = META[r.symbol] || {};
      return {
        ticker: r.symbol,
        price: Number.isFinite(r.price) ? r.price : null,
        dailyReturn: Number.isFinite(r.changePercent) ? r.changePercent : null,
        yield: meta.yield || "‚Äî",
        expense: meta.expense || "‚Äî",
        assets: meta.assets || "‚Äî",
        frequency: meta.frequency || "‚Äî",
        strategy: meta.strategy || "‚Äî",
        risk: meta.risk || "‚Äî",
        source: r.source || "API"
      };
    });

    render();
    updateStats();
    last.textContent = `Last updated: ${new Date().toLocaleString()}`;
    table.style.display = 'block';
    stats.style.display = 'grid';
  } catch(e){
    console.error(e);
    status.className = 'data-status status-error';
    status.innerHTML = '<span>‚ùå</span><span>Data Error</span>';
  } finally {
    loading.style.display = 'none';
    btn.disabled = false;
  }
}

function render(){
  const tb = document.getElementById('etfTableBody');
  tb.innerHTML = '';
  etfData.forEach(etf => {
    const pct = etf.dailyReturn;
    const cls = classForReturn(pct);
    const sign = (pct > 0 ? '+' : '');
    const priceStr = etf.price != null ? etf.price.toFixed(2) : '-';
    const pctStr = isFinite(pct) ? `${sign}${pct.toFixed(2)}%` : '‚Äî';
    const riskColor =
      /Very High/.test(etf.risk) ? '#ff4757' :
      /High/.test(etf.risk) ? '#ffa502' :
      /Medium/.test(etf.risk) ? '#3742fa' :
      /Low/.test(etf.risk) ? '#2ed573' : '#9ca3af';

    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><div class="ticker">${etf.ticker}</div></td>
      <td><div class="price">${priceStr}</div></td>
      <td>
        <div class="daily-return ${cls}">${pctStr}</div>
        <div class="data-source">Yahoo</div>
      </td>
      <td><span class="badge badge-yield">${etf.yield}</span></td>
      <td><span class="badge badge-exp">${etf.expense}</span></td>
      <td>${etf.assets}</td>
      <td>${etf.frequency}</td>
      <td>${etf.strategy}</td>
      <td><span style="color:${riskColor}; font-weight:600;">${etf.risk}</span></td>
    `;
    tb.appendChild(tr);
  });
}

function updateStats(){
  const total = etfData.length;
  const gainers = etfData.filter(e => e.dailyReturn > 0).length;
  const losers = etfData.filter(e => e.dailyReturn < 0).length;
  const avg = etfData.reduce((s,e)=> s + (isFinite(e.dailyReturn) ? e.dailyReturn : 0), 0) / (total || 1);
  document.getElementById('totalETFs').textContent = total;
  document.getElementById('gainers').textContent = gainers;
  document.getElementById('losers').textContent = losers;
  document.getElementById('avgReturn').textContent = (isFinite(avg) ? avg.toFixed(2) : '‚Äî') + '%';
}

function attachSort(){
  document.querySelectorAll('th[data-col]').forEach(th => {
    th.addEventListener('click', () => {
      const col = th.getAttribute('data-col');
      sortDir *= -1;
      etfData.sort((a,b) => {
        const av = a[col]; const bv = b[col];
        if (typeof av === 'number' && typeof bv === 'number') {
          return sortDir === 1 ? av - bv : bv - av;
        }
        return String(av ?? '').localeCompare(String(bv ?? '')) * (sortDir === 1 ? 1 : -1);
      });
      render();
    });
  });
}

document.getElementById('refreshBtn').addEventListener('click', load);
attachSort();
load();
setInterval(load, 60 * 1000); // refresh every 60s
</script>
</body>
</html>
